---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: copilot-agent-readonly
  labels:
    app.kubernetes.io/name: copilot-agent
    app.kubernetes.io/component: rbac
rules:
  # Core resources - read-only
  - apiGroups: [""]
    resources:
      - pods
      - pods/log
      - pods/status
      - services
      - endpoints
      - configmaps
      - persistentvolumeclaims
      - persistentvolumes
      - nodes
      - namespaces
      - events
      - resourcequotas
      - limitranges
      - serviceaccounts
    verbs:
      - get
      - list
      - watch

  # Apps resources - read-only
  - apiGroups: ["apps"]
    resources:
      - deployments
      - daemonsets
      - replicasets
      - statefulsets
    verbs:
      - get
      - list
      - watch

  # Batch resources - read-only
  - apiGroups: ["batch"]
    resources:
      - jobs
      - cronjobs
    verbs:
      - get
      - list
      - watch

  # Networking resources - read-only
  - apiGroups: ["networking.k8s.io"]
    resources:
      - ingresses
      - networkpolicies
      - ingressclasses
    verbs:
      - get
      - list
      - watch

  # Storage resources - read-only
  - apiGroups: ["storage.k8s.io"]
    resources:
      - storageclasses
      - volumeattachments
    verbs:
      - get
      - list
      - watch

  # RBAC resources - read-only
  - apiGroups: ["rbac.authorization.k8s.io"]
    resources:
      - roles
      - rolebindings
      - clusterroles
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch

  # Flux CD resources - read-only
  - apiGroups: ["source.toolkit.fluxcd.io"]
    resources:
      - gitrepositories
      - helmrepositories
      - helmcharts
      - buckets
      - ocirepositories
    verbs:
      - get
      - list
      - watch

  - apiGroups: ["kustomize.toolkit.fluxcd.io"]
    resources:
      - kustomizations
    verbs:
      - get
      - list
      - watch

  - apiGroups: ["helm.toolkit.fluxcd.io"]
    resources:
      - helmreleases
    verbs:
      - get
      - list
      - watch

  - apiGroups: ["notification.toolkit.fluxcd.io"]
    resources:
      - alerts
      - providers
      - receivers
    verbs:
      - get
      - list
      - watch

  - apiGroups: ["image.toolkit.fluxcd.io"]
    resources:
      - imagerepositories
      - imagepolicies
      - imageupdateautomations
    verbs:
      - get
      - list
      - watch

  # Cert-manager resources - read-only
  - apiGroups: ["cert-manager.io"]
    resources:
      - certificates
      - certificaterequests
      - issuers
      - clusterissuers
    verbs:
      - get
      - list
      - watch

  # Metrics resources - read-only
  - apiGroups: ["metrics.k8s.io"]
    resources:
      - nodes
      - pods
    verbs:
      - get
      - list

  # Sealed Secrets - read-only
  - apiGroups: ["bitnami.com"]
    resources:
      - sealedsecrets
    verbs:
      - get
      - list
      - watch

  # Monitoring resources - read-only
  - apiGroups: ["monitoring.coreos.com"]
    resources:
      - servicemonitors
      - podmonitors
      - prometheuses
      - alertmanagers
      - prometheusrules
    verbs:
      - get
      - list
      - watch
