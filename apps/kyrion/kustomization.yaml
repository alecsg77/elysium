apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../base/coder
  - ../base/registry

patches:
  - path: coder-values.yaml
    target:
      kind: HelmRelease
      name: coder
  - patch: |-
      - op: add
        path: "/spec/values/coder/env/-"
        value:
          name: CODER_ACCESS_URL
          value: "https://coder.flyingfox-tailor.ts.net"
    target:
      kind: HelmRelease
      name: coder
  - path: coder-logstream-kube-values.yaml
    target:
      kind: HelmRelease
      name: coder-logstream-kube

configMapGenerator:
  - name: registry-config-env
    namespace: registry
    envs:
      - registry.env